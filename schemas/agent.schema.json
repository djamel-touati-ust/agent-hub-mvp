{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ust.local/schemas/agent.schema.json",
  "title": "UST Agent Manifest",
  "type": "object",
  "required": ["name", "version", "owner", "language", "frameworks", "description", "license", "entrypoints", "mcp", "a2a"],
  "properties": {
    "name": { "type": "string", "pattern": "^[a-z0-9][-a-z0-9]{1,62}$" },
    "version": { "type": "string", "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:[-+][0-9A-Za-z.-]+)?$" },
    "owner": { "type": "string", "format": "email" },
    "language": { "type": "string", "enum": ["python"] },
    "frameworks": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string", "enum": ["langgraph", "langchain", "none"] },
      "uniqueItems": true
    },
    "description": { "type": "string", "minLength": 10 },
    "license": { "type": "string", "enum": ["internal"] },

    "entrypoints": {
      "type": "object",
      "required": ["mcp", "a2a"],
      "properties": {
        "mcp": {
          "oneOf": [
            {
              "title": "stdio",
              "type": "object",
              "required": ["type", "command"],
              "properties": {
                "type": { "const": "stdio" },
                "command": { "type": "string" },
                "args": { "type": "array", "items": { "type": "string" }, "default": [] },
                "env": { "type": "object", "additionalProperties": { "type": "string" } }
              },
              "additionalProperties": false
            },
            {
              "title": "http",
              "type": "object",
              "required": ["type", "url"],
              "properties": {
                "type": { "const": "http" },
                "url": { "type": "string", "format": "uri" }
              },
              "additionalProperties": false
            }
          ]
        },
        "a2a": {
          "type": "object",
          "required": ["url", "transport"],
          "properties": {
            "url": { "type": "string", "format": "uri" },
            "transport": { "type": "string", "enum": ["JSONRPC"] }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "mcp": {
      "type": "object",
      "required": ["tools"],
      "properties": {
        "tools": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["name", "inputSchema"],
            "properties": {
              "name": { "type": "string", "pattern": "^[a-zA-Z0-9_.:-]{1,64}$" },
              "description": { "type": "string" },
              "inputSchema": { "$ref": "https://json-schema.org/draft/2020-12/schema" }
            },
            "additionalProperties": false
          }
        },
        "resources": { "type": "array", "items": { "type": "object" } },
        "prompts": { "type": "array", "items": { "type": "object" } }
      },
      "additionalProperties": false
    },

    "a2a": {
      "type": "object",
      "required": ["skills"],
      "properties": {
        "skills": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "description", "inputSchema", "outputSchema"],
            "properties": {
              "id": { "type": "string", "pattern": "^[a-z0-9_.:-]{1,64}$" },
              "description": { "type": "string" },
              "inputSchema": { "$ref": "https://json-schema.org/draft/2020-12/schema" },
              "outputSchema": { "$ref": "https://json-schema.org/draft/2020-12/schema" }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },

    "models": {
      "type": "object",
      "properties": { "default": { "type": "string" } },
      "additionalProperties": true
    },

    "env": {
      "type": "object",
      "properties": { "required": { "type": "array", "items": { "type": "string" }, "uniqueItems": true } },
      "additionalProperties": false
    },

    "security": {
      "type": "object",
      "properties": {
        "data_access": { "type": "string" },
        "outbound_network": { "type": "array", "items": { "type": "string" }, "uniqueItems": true }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
